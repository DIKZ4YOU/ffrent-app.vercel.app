<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JSX Live â€” Upload & Preview</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg:    #0a0a0f;
      --card:  #12121a;
      --border:#2a2a3d;
      --accent:#7c5cfc;
      --green: #00e5a0;
      --red:   #ff4466;
      --text:  #e8e8f0;
      --muted: #5a5a72;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Syne', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px 80px;
    }

    /* â”€â”€ Header â”€â”€ */
    header {
      text-align: center;
      margin-bottom: 48px;
    }
    header .badge {
      display: inline-block;
      background: linear-gradient(135deg, var(--accent), #a78bfa);
      color: #fff;
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 4px 14px;
      border-radius: 20px;
      margin-bottom: 16px;
    }
    header h1 {
      font-size: clamp(2rem, 6vw, 3.6rem);
      font-weight: 800;
      background: linear-gradient(135deg, #fff 30%, var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      line-height: 1.1;
    }
    header p {
      margin-top: 12px;
      color: var(--muted);
      font-size: 1rem;
    }

    /* â”€â”€ Drop Zone â”€â”€ */
    .dropzone {
      width: 100%;
      max-width: 560px;
      border: 2px dashed var(--border);
      border-radius: 20px;
      background: var(--card);
      padding: 48px 32px;
      text-align: center;
      cursor: pointer;
      transition: border-color .25s, background .25s, transform .2s;
      position: relative;
    }
    .dropzone:hover,
    .dropzone.dragover {
      border-color: var(--accent);
      background: #16162a;
      transform: scale(1.01);
    }
    .dropzone input[type="file"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
      width: 100%;
      height: 100%;
    }
    .dropzone .icon {
      font-size: 56px;
      margin-bottom: 16px;
      display: block;
    }
    .dropzone h2 {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .dropzone p {
      color: var(--muted);
      font-size: .9rem;
      font-family: 'Space Mono', monospace;
    }
    .dropzone .file-chosen {
      margin-top: 14px;
      color: var(--green);
      font-family: 'Space Mono', monospace;
      font-size: .85rem;
    }

    /* â”€â”€ Upload Button â”€â”€ */
    #uploadBtn {
      margin-top: 20px;
      width: 100%;
      max-width: 560px;
      padding: 16px;
      background: linear-gradient(135deg, var(--accent), #a78bfa);
      color: #fff;
      font-family: 'Syne', sans-serif;
      font-size: 1.05rem;
      font-weight: 700;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      letter-spacing: .5px;
      transition: opacity .2s, transform .15s;
      display: none;
    }
    #uploadBtn:hover  { opacity: .9; transform: translateY(-1px); }
    #uploadBtn:active { transform: translateY(0); }

    /* â”€â”€ Progress â”€â”€ */
    #progressWrap {
      margin-top: 16px;
      width: 100%;
      max-width: 560px;
      display: none;
    }
    #progressBar {
      height: 6px;
      background: var(--border);
      border-radius: 99px;
      overflow: hidden;
    }
    #progressFill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), var(--green));
      border-radius: 99px;
      transition: width .2s;
    }
    #progressLabel {
      margin-top: 8px;
      font-family: 'Space Mono', monospace;
      font-size: .8rem;
      color: var(--muted);
    }

    /* â”€â”€ Toast â”€â”€ */
    #toast {
      display: none;
      margin-top: 16px;
      max-width: 560px;
      width: 100%;
      padding: 14px 20px;
      border-radius: 12px;
      font-family: 'Space Mono', monospace;
      font-size: .85rem;
      border-left: 4px solid;
    }
    #toast.success { background:#00e5a015; border-color:var(--green); color:var(--green); }
    #toast.error   { background:#ff446615; border-color:var(--red);   color:var(--red);  }

    /* â”€â”€ Preview Link â”€â”€ */
    #previewLink {
      display: none;
      margin-top: 14px;
      width: 100%;
      max-width: 560px;
      padding: 14px 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      text-decoration: none;
      color: var(--text);
      font-weight: 700;
      text-align: center;
      transition: border-color .2s, background .2s;
    }
    #previewLink:hover { border-color: var(--accent); background: #16162a; }
    #previewLink span  { color: var(--accent); }

    /* â”€â”€ Divider â”€â”€ */
    .divider {
      width: 100%;
      max-width: 560px;
      border: none;
      border-top: 1px solid var(--border);
      margin: 40px 0 28px;
    }

    /* â”€â”€ File List â”€â”€ */
    #fileList {
      width: 100%;
      max-width: 560px;
    }
    #fileList h3 {
      font-size: 1rem;
      color: var(--muted);
      margin-bottom: 16px;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-family: 'Space Mono', monospace;
    }
    .file-item {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 10px;
      transition: border-color .2s;
    }
    .file-item:hover { border-color: var(--accent); }
    .file-item .fi-icon { font-size: 24px; }
    .file-item .fi-name {
      flex: 1;
      font-family: 'Space Mono', monospace;
      font-size: .8rem;
      color: var(--muted);
      word-break: break-all;
    }
    .file-item a.open-btn {
      background: var(--accent);
      color: #fff;
      text-decoration: none;
      padding: 6px 14px;
      border-radius: 8px;
      font-size: .8rem;
      font-weight: 700;
      white-space: nowrap;
    }
    .file-item .del-btn {
      background: none;
      border: 1px solid var(--border);
      color: var(--muted);
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: .8rem;
      transition: border-color .2s, color .2s;
    }
    .file-item .del-btn:hover { border-color: var(--red); color: var(--red); }

    .no-files {
      text-align: center;
      color: var(--muted);
      font-family: 'Space Mono', monospace;
      font-size: .85rem;
      padding: 24px;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="badge">âš¡ JSX Live</div>
    <h1>Upload JSX<br/>Langsung Jadi Website</h1>
    <p>Pilih file .jsx / .js / .tsx â€¢ Preview otomatis terbuka</p>
  </header>

  <!-- Drop Zone -->
  <div class="dropzone" id="dropzone">
    <input type="file" id="fileInput" accept=".jsx,.js,.tsx,.ts" />
    <span class="icon">ğŸ“‚</span>
    <h2>Drag &amp; Drop File JSX</h2>
    <p>.jsx &nbsp;Â·&nbsp; .js &nbsp;Â·&nbsp; .tsx &nbsp;Â·&nbsp; .ts</p>
    <div class="file-chosen" id="fileChosen"></div>
  </div>

  <button id="uploadBtn">ğŸš€&nbsp; Upload &amp; Buat Website</button>

  <!-- Progress -->
  <div id="progressWrap">
    <div id="progressBar"><div id="progressFill"></div></div>
    <div id="progressLabel">Menguploadâ€¦</div>
  </div>

  <!-- Toast -->
  <div id="toast"></div>

  <!-- Preview Link -->
  <a id="previewLink" target="_blank">
    ğŸŒ &nbsp;Buka Website &nbsp;<span>â†’</span>
  </a>

  <hr class="divider" />

  <!-- Uploaded files list -->
  <div id="fileList">
    <h3>ğŸ“ &nbsp;File Terupload</h3>
    <div id="fileItems"><div class="no-files">Belum ada file yang diupload.</div></div>
  </div>

  <script>
    const dropzone    = document.getElementById('dropzone');
    const fileInput   = document.getElementById('fileInput');
    const fileChosen  = document.getElementById('fileChosen');
    const uploadBtn   = document.getElementById('uploadBtn');
    const progressWrap= document.getElementById('progressWrap');
    const progressFill= document.getElementById('progressFill');
    const progressLbl = document.getElementById('progressLabel');
    const toast       = document.getElementById('toast');
    const previewLink = document.getElementById('previewLink');

    let selectedFile = null;

    // â”€â”€ File selected â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    fileInput.addEventListener('change', () => {
      if (fileInput.files[0]) selectFile(fileInput.files[0]);
    });

    function selectFile(file) {
      selectedFile = file;
      fileChosen.textContent = 'âœ…  ' + file.name;
      uploadBtn.style.display = 'block';
      hideToast();
      previewLink.style.display = 'none';
    }

    // â”€â”€ Drag & Drop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    dropzone.addEventListener('dragover', e => { e.preventDefault(); dropzone.classList.add('dragover'); });
    dropzone.addEventListener('dragleave',()=> dropzone.classList.remove('dragover'));
    dropzone.addEventListener('drop', e => {
      e.preventDefault();
      dropzone.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file) selectFile(file);
    });

    // â”€â”€ Upload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    uploadBtn.addEventListener('click', () => {
      if (!selectedFile) return;

      const formData = new FormData();
      formData.append('jsxfile', selectedFile);

      progressWrap.style.display = 'block';
      uploadBtn.disabled = true;
      hideToast();

      const xhr = new XMLHttpRequest();
      xhr.open('POST', '/upload');

      xhr.upload.addEventListener('progress', e => {
        if (e.lengthComputable) {
          const pct = Math.round(e.loaded / e.total * 100);
          progressFill.style.width = pct + '%';
          progressLbl.textContent = `Menguploadâ€¦ ${pct}%`;
        }
      });

      xhr.addEventListener('load', () => {
        progressWrap.style.display = 'none';
        uploadBtn.disabled = false;

        if (xhr.status === 200) {
          const data = JSON.parse(xhr.responseText);
          showToast('success', `âœ…  Berhasil! "${selectedFile.name}" sudah jadi website.`);
          previewLink.href = data.url;
          previewLink.style.display = 'block';
          window.open(data.url, '_blank');
          loadFiles();
          // reset
          fileInput.value = '';
          selectedFile = null;
          fileChosen.textContent = '';
          uploadBtn.style.display = 'none';
        } else {
          const err = JSON.parse(xhr.responseText);
          showToast('error', 'âŒ  ' + (err.error || 'Upload gagal.'));
        }
      });

      xhr.addEventListener('error', () => {
        progressWrap.style.display = 'none';
        uploadBtn.disabled = false;
        showToast('error', 'âŒ  Koneksi error. Coba lagi.');
      });

      xhr.send(formData);
    });

    // â”€â”€ Toast helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showToast(type, msg) {
      toast.className = type;
      toast.textContent = msg;
      toast.style.display = 'block';
    }
    function hideToast() {
      toast.style.display = 'none';
    }

    // â”€â”€ Load file list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadFiles() {
      const res   = await fetch('/api/files');
      const files = await res.json();
      const wrap  = document.getElementById('fileItems');

      if (!files.length) {
        wrap.innerHTML = '<div class="no-files">Belum ada file yang diupload.</div>';
        return;
      }

      wrap.innerHTML = files.map(f => `
        <div class="file-item" id="fi-${f.filename}">
          <span class="fi-icon">âš›ï¸</span>
          <span class="fi-name">${f.filename}</span>
          <a class="open-btn" href="${f.url}" target="_blank">Buka</a>
          <button class="del-btn" onclick="deleteFile('${f.filename}')">Hapus</button>
        </div>
      `).join('');
    }

    async function deleteFile(filename) {
      if (!confirm(`Hapus ${filename}?`)) return;
      await fetch(`/api/files/${encodeURIComponent(filename)}`, { method: 'DELETE' });
      loadFiles();
    }

    // Init
    loadFiles();
  </script>
</body>
</html>
